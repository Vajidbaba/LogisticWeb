--spu_GetSearchLCTCheckListDataTable 0,10,'','','','01-Nov-2023', '01-Feb-2024','"

ALTER proc [dbo].[spu_GetSearchLCTCheckListDataTable](
@start INT, @length INT, @SearchText VARCHAR(50), @sortColumn Int,@sortOrder VARCHAR(50), @FROMDate VARCHAR(30), @ToDate VARCHAR(30),
@ClaimNumber varchar(30),
@IDHas VARCHAR(30), @LccTpxUserId VARCHAR(30), @SupervisorUsername VARCHAR(30), @LCTLeadershipHandling VARCHAR(30),
@LogEntryType VARCHAR(30), @SLPDEndDate VARCHAR(30), @TypeOfIssue VARCHAR(30), @Resolution VARCHAR(30), @K250Payment VARCHAR(30), @SupLogSupportUnitReview varchar(50), @Status INT)

as
begin
SET NOCOUNT ON;
declare @TemTable table (ID int, Active bit, CreatedOn datetime, ClaimNumber varchar(500), IDHas varchar(500), LccTpxUserId varchar(500), SupervisorUsername varchar(500), LCTLeadershipHandling varchar(500),

TypeOfIssueOtherValue varchar(500), LogEntryType varchar(500), SLPDEndDate date, ResolutionOtherValue varchar(500), K250PaymentOtherValue varchar(500),

SuplogTypeOfIssue varchar(500), SupLogSupportUnitReview varchar(500), SupLogResolution varchar(500), SupLogK250Payment varchar(500), TypeOfIssue varchar(max), Resolution varchar(max), K250Payment varchar(max));

with temp as (

select L.Active, L.CreatedOn, L.Id, L.ClaimNumber, L.IDHas, L.LccTpxUserId, L.SupervisorUsername, isnull(L.LCTLeadershipHandling,'') as LCTLeadershipHandling,
isnull(L. TypeOfIssueOtherValue,'') as

TypeOfIssueOtherValue, L.LogEntry Type, format(L.SLPDEndDate, 'MM/dd/yyyy') as SLPDEndDate,

isnull(L.ResolutionOtherValue,'') as ResolutionOtherValue, isnull(L.K250PaymentOtherValue,'') as K250PaymentOtherValue,

isnull(stuff((select ' ,'+ A. Name from LCTCheckListSupLogTypeOfIssue as A where A.LCTCheckListId=L.id and

A.Active=1 for XML Path('')),1,2,''),'')as SuplogTypeOfIssue, 
isnull(stuff((select ' ,' + A.Name from LCTCheckListSupLogSupportUnitReview as A where A.LCTCheckListId=L.id and

A.Active=1 for XML Path('')),1,2,''),'')as SupLogSupportUnitReview,

isnull(stuff((select ','+ A.Name from LCTCheckListSupLogResolution as A where A.LCTCheckListId=L.id and A.Active=1 for XML Path('')),1,2,''),'')as SupLogResolution,

isnull(stuff((select','+ A.Name from LCTCheckListSupLogK250Payment as A where A.LCTCheckListId=L.id and A.Active=1 for XML Path('')),1,2,''),'')as SupLogK250Payment

from LCTCheckListSupLog as L

where L.Active=1 and L.Status = @Status

and (@ClaimNumber !='' or cast(L.CreatedOn as date) between cast(@FROMDate as date) and cast (@ToDate as date))

)

insert into @TemTable(ID,Active, CreatedOn, ClaimNumber, IDHas, LccTpxUserId, SupervisorUsername, LCTLeadershipHandling,

TypeOfIssueOtherValue,LogEntryType, SLPDEndDate, ResolutionOtherValue, K250PaymentOtherValue, SuplogTypeOfIssue, SupLogSupportUnitReview, SupLogResolution, SupLogK250Payment,

TypeOfIssue, Resolution, K250Payment)

select ID, Active, CreatedOn, ClaimNumber, IDHas, LccTpxUserId, SupervisorUsername, LCTLeadershipHandling, TypeOfIssueOtherValue, 
isnull(LogEntryType,'')as LogEntryType, SLPDEndDate, ResolutionOtherValue, K250PaymentOtherValue,
SuplogTypeOfIssue, SupLogSupportUnitReview, SupLogResolution, SupLogKk250Payment,

(isnull(SuplogTypeOfIssue, '') +''+ isnull(TypeOfIssueOtherValue,'')) as TypeOfIssue, 
(isnull(SupLogResolution,'') +''+ isnull(ResolutionOtherValue,'')) as Resolution, 
(isnull(SupLogK250Payment,'') +''+ isnull(K250PaymentOtherValue,'')) as K250Payment

from temp

select *, count(Id) OVER () AS TotalCount from @TemTable

where (

(

@SearchText <> AND (

K250PaymentOtherValue LIKE '%' + @SearchText + '%'
OR IDHas LIKE '%' + @SearchText + '%'
OR LccTpxUserId LIKE '%' + @SearchText + '%'
OR SupervisorUsername LIKE '%' + @SearchText + '%'
OR LCTLeadershipHandling LIKE '%' + @SearchText + '%'
OR TypeOfIssueOtherValue LIKE '%' + @SearchText + '%'
OR LogEntryType LIKE '%' + @SearchText + '%'
OR ClaimNumber LIKE '%' + @SearchText + '%' 
OR TypeOfIssue LIKE '%' + @SearchText + '%' 
OR Resolution LIKE '%' + @SearchText + '%' 
OR K250Payment LIKE '%' + @SearchText + '%'

)

)

OR (@SearchText = '')

)

and SLPDEndDate in (case when isnull(@SLPDEndDate,'') ='' then SLPDEndDate else cast (@SLPDEndDate as date) end) 
and LogEntryType in (case when isnull(@LogEntryType, '') ='' then LogEntryType else @LogEntryType end)
and (@ClaimNumber ='' or ClaimNumber like '%'+@ClaimNumber+'%')
and (@IDHas ='' or IDHas like '%'+@IDHas+'%')
and (@LccTpxUserId ='' or LccTpxUserId like '+'@LccTpxUserId+'%')
and (@SupervisorUsername = or SupervisorUsername like '%'+@SupervisorUsername+'%')
and (@LCTLeadershipHandling = or LCTLeadershipHandling like '%' + @LCTLeadershipHandling+'%')
and (((@Resolution='blank') and Resolution='') or Resolution like '%' + @Resolution+ '%') 
and (((@K250Payment='blank') and K250Payment='') or K250Payment like '%'+@K250Payment+'%')
and (((@SupLogSupportUnitReview='blank') and SupLogSupport UnitReview='') or SupLogSupportUnitReview like '%'+ @SupLogSupportUnitReview+'%')
and (((@TypeOfIssue='blank') and TypeOfIssue='') or TypeOfIssue like '%' + @TypeOfIssue+'%')
ORDER BY ID desc
OFFSET @start ROWS
FETCH NEXT @length ROWS ONLY
end